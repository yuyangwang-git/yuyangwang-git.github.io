<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>使用 MATLAB Coder 生成 Cpp 源码 | Yuyang Wang's Blog</title><meta name=keywords content="C++,MATLAB"><meta name=description content="由于需要将 MATLAB 实现的算法快速移植到 QT 客户端中，研究了一下如何利用 MATLAB Coder 将算法转译为 C++ 源码"><meta name=author content><link rel=canonical href=https://yuyangwang-git.github.io/posts/%E4%BD%BF%E7%94%A8matlab-coder%E7%94%9F%E6%88%90cpp%E6%BA%90%E7%A0%81/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://yuyangwang-git.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://yuyangwang-git.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://yuyangwang-git.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://yuyangwang-git.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://yuyangwang-git.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css integrity=sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.js integrity=sha384-Qsn9KnoKISj6dI8g7p1HBlNpVx0I8p1SvlwOldgi3IorMle61nQy4zEahWYtljaz crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})'></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PG166B7MZ2"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PG166B7MZ2",{anonymize_ip:!1})}</script><meta property="og:title" content="使用 MATLAB Coder 生成 Cpp 源码"><meta property="og:description" content="由于需要将 MATLAB 实现的算法快速移植到 QT 客户端中，研究了一下如何利用 MATLAB Coder 将算法转译为 C++ 源码"><meta property="og:type" content="article"><meta property="og:url" content="https://yuyangwang-git.github.io/posts/%E4%BD%BF%E7%94%A8matlab-coder%E7%94%9F%E6%88%90cpp%E6%BA%90%E7%A0%81/"><meta property="og:image" content="https://yuyangwang-git.github.io/img/cover.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-10T19:14:52+08:00"><meta property="article:modified_time" content="2022-08-10T19:14:52+08:00"><meta property="og:site_name" content="Yuyang Wang's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yuyangwang-git.github.io/img/cover.jpg"><meta name=twitter:title content="使用 MATLAB Coder 生成 Cpp 源码"><meta name=twitter:description content="由于需要将 MATLAB 实现的算法快速移植到 QT 客户端中，研究了一下如何利用 MATLAB Coder 将算法转译为 C++ 源码"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://yuyangwang-git.github.io/posts/"},{"@type":"ListItem","position":3,"name":"使用 MATLAB Coder 生成 Cpp 源码","item":"https://yuyangwang-git.github.io/posts/%E4%BD%BF%E7%94%A8matlab-coder%E7%94%9F%E6%88%90cpp%E6%BA%90%E7%A0%81/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"使用 MATLAB Coder 生成 Cpp 源码","name":"使用 MATLAB Coder 生成 Cpp 源码","description":"由于需要将 MATLAB 实现的算法快速移植到 QT 客户端中，研究了一下如何利用 MATLAB Coder 将算法转译为 C++ 源码","keywords":["C++","MATLAB"],"articleBody":"准备工作 Installing Prerequisite Products MATLAB MATLAB Coder MATLAB ToolBox (e.g. Signal Processing ToolBox) C++ compiler MATLAB 及 MATLAB Coder 的安装方法请自行查阅 MATLAB 官方文档。\n如果 MATLAB 安装在包含非 7 位 ASCII 字符（例如日语字符）的路径中，MATLAB Coder 可能会由于找不到代码生成库函数而无法工作。\n— MathWorks1\n不同的MATLAB版本支持的C/C++编译器也不同，详细的支持列表可参考 MATLAB 官方文档，本文将在如下环境中完成所有工作：\nMATLAB 2022a Microsoft Visual C++ 2022 v17.0 | nmake (64-bit Windows) 注意：Microsoft Visual C++ 2022 is supported as of R2022a.\n使用 MATLAB Coder 生成 Cpp 源码 本节内容参考 MATLAB 官方文档 使用 MATLAB Coder App 生成 C 代码。\n准备待转换的 MATLAB 代码 假定我们已经有了一个利用 MATLAB Wavelet Toolbox 编写的文件WaveLet_Fcn.m，该文件包含一个滤波函数WaveLet_Fcn()，内容如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 function s0 = WaveLet_Fcn(data) %#codegen s=data; [c,l]=wavedec(s,7,'coif5'); ca11=appcoef(c,l,'coif5',7); cd1=detcoef(c,l,1); cd2=detcoef(c,l,2); cd3=detcoef(c,l,3); cd4=detcoef(c,l,4); cd5=detcoef(c,l,5); cd6=detcoef(c,l,6); cd7=detcoef(c,l,7); sd1=zeros(1,length(cd1)); sd2=wthresh(cd2,'s',0.014); sd3=wthresh(cd3,'s',0.014); sd4=wthresh(cd4,'s',0.014); sd5=wthresh(cd5,'s',0.014); sd6=wthresh(cd6,'s',0.014); sd7=wthresh(cd7,'s',0.014); c2=[ca11,sd7,sd6,sd5,sd4,sd3,sd2,sd1]; s0=waverec(c2,l,'coif5'); end 该函数具有一个参数data和一个返回值s0，由于 C++ 是静态类型语言，后面我们将会看到，我们需要手动指定data在转换后的实际类型（只需指定函数参数即可，MATLAB 会自动推断返回值类型）。\n注意第一行中我们在函数名后增加了注释%#codegen，该指令会通知 Coder 检查是否存在可能的错误，如果有错就会用波浪线标识出来，详细内容可参考官方文档。\n打开 MATLAB Coder 并设置变量类型 在确认没有红色波浪线后，点击 MATLAB 主界面顶端工具栏 “APP—MATLAB Coder” 进入如下图所示的界面：\n选择待转换的.m文件，点击右下角Next，随后点击Let me enter input or global types directly，这里要指定函数参数data的类型，假设我们希望该变量为double类型一维数组，长度可变，故设置为：\n检查 Run-Time 问题并转换代码 接下来开始选择测试文件，测试文件是一个调用了上述WaveLet_Fcn()函数的文件，这里，我们先新建一个test.m文件，然后在其中写入以下内容：\ndata = [0, 0, 0, 0]; [res] = WaveLet_Fcn(data); disp(res) test.m文件应与WaveLet_Fcn.m放置在同一目录下：\nyour_project_name/ ├── WaveLet_Fcn.m └── test.m 随后回到 MATLAB Coder，在输入框中选中我们刚刚新建的test.m文件，然后点击Check for Issues。这里如果提示：\nError evaluating test code. 原因: 函数或变量 'test' 无法识别 请退出 MATLAB Coder，在 MATLAB 中运行一次test.m文件，把test.m文件所在目录添加到 MATLAB 路径中，再重新运行 MATLAB Coder，点击Reopen，即可正确运行。\n如果程序提醒：No issues detected.\n则直接继续点击Next：\n按上图调整设置，并点击生成代码。弹出的界面左下角可以看到输出的所有 C++ 文件（.h和.Cpp）：\n这些文件都被放置在WaveLet_Fcn.m所在目录的codegen\\lib\\WaveLet_Fcn文件夹下。只需将所有.h和.Cpp复制到 QT Project 或其它项目中编译即可，函数入口就在WaveLet_Fcn.h文件中。\nyour_project_name/ ├── WaveLet_Fcn.m ├── test.m └── codegen/ ├── lib/ │ └── WaveLet_Fcn/ │ ├── examples/ │ │ └── ... │ ├── html/ │ │ └── ... │ ├── interface/ │ │ └── ... │ ├── idwt.c │ ├── idwt.h │ ├── rt_nonfinite.c │ ├── rt_nonfinite.h │ ├── rtGetInf.c │ ├── rtGetInf.h │ ├── rtGetNaN.c │ ├── rtGetNaN.h │ ├── rtwtypes.h │ ├── upsconv1.c │ ├── upsconv1.h │ ├── wavedec.c │ ├── wavedec.h │ ├── WaveLet_Fcn_data.c │ ├── WaveLet_Fcn_data.h │ ├── WaveLet_Fcn_emxAPI.c │ ├── WaveLet_Fcn_emxAPI.h │ ├── WaveLet_Fcn_emxutil.c │ ├── WaveLet_Fcn_emxutil.h │ ├── WaveLet_Fcn_initialize.c │ ├── WaveLet_Fcn_initialize.h │ ├── WaveLet_Fcn_terminate.c │ ├── WaveLet_Fcn_terminate.h │ ├── WaveLet_Fcn_types.h │ ├── WaveLet_Fcn.c │ ├── WaveLet_Fcn.h │ ├── wkeep1.c │ └── wkeep1.h └── mex/ └── ... The above note is excerpted from MathWorks’ Help Center. ↩︎\n","wordCount":"334","inLanguage":"en","image":"https://yuyangwang-git.github.io/img/cover.jpg","datePublished":"2022-08-10T19:14:52+08:00","dateModified":"2022-08-10T19:14:52+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://yuyangwang-git.github.io/posts/%E4%BD%BF%E7%94%A8matlab-coder%E7%94%9F%E6%88%90cpp%E6%BA%90%E7%A0%81/"},"publisher":{"@type":"Organization","name":"Yuyang Wang's Blog","logo":{"@type":"ImageObject","url":"https://yuyangwang-git.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yuyangwang-git.github.io accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yuyangwang-git.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://yuyangwang-git.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://example.org title=Server><span>Server</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://yuyangwang-git.github.io>Home</a>&nbsp;»&nbsp;<a href=https://yuyangwang-git.github.io/posts/>Posts</a></div><h1 class=post-title>使用 MATLAB Coder 生成 Cpp 源码</h1><div class=post-meta><span title='2022-08-10 19:14:52 +0800 CST'>August 10, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;334 words</div></header><figure class=entry-cover><img loading=lazy srcset="https://yuyangwang-git.github.io/posts/%E4%BD%BF%E7%94%A8matlab-coder%E7%94%9F%E6%88%90cpp%E6%BA%90%E7%A0%81/img/cover_hu8b68f1f323d041c7aaf9dc014e2c4b2c_908634_360x0_resize_q75_box.jpg 360w ,https://yuyangwang-git.github.io/posts/%E4%BD%BF%E7%94%A8matlab-coder%E7%94%9F%E6%88%90cpp%E6%BA%90%E7%A0%81/img/cover_hu8b68f1f323d041c7aaf9dc014e2c4b2c_908634_480x0_resize_q75_box.jpg 480w ,https://yuyangwang-git.github.io/posts/%E4%BD%BF%E7%94%A8matlab-coder%E7%94%9F%E6%88%90cpp%E6%BA%90%E7%A0%81/img/cover_hu8b68f1f323d041c7aaf9dc014e2c4b2c_908634_720x0_resize_q75_box.jpg 720w ,https://yuyangwang-git.github.io/posts/%E4%BD%BF%E7%94%A8matlab-coder%E7%94%9F%E6%88%90cpp%E6%BA%90%E7%A0%81/img/cover_hu8b68f1f323d041c7aaf9dc014e2c4b2c_908634_1080x0_resize_q75_box.jpg 1080w ,https://yuyangwang-git.github.io/posts/%E4%BD%BF%E7%94%A8matlab-coder%E7%94%9F%E6%88%90cpp%E6%BA%90%E7%A0%81/img/cover_hu8b68f1f323d041c7aaf9dc014e2c4b2c_908634_1500x0_resize_q75_box.jpg 1500w ,https://yuyangwang-git.github.io/posts/%E4%BD%BF%E7%94%A8matlab-coder%E7%94%9F%E6%88%90cpp%E6%BA%90%E7%A0%81/img/cover.jpg 3137w" sizes="(min-width: 768px) 720px, 100vw" src=https://yuyangwang-git.github.io/posts/%E4%BD%BF%E7%94%A8matlab-coder%E7%94%9F%E6%88%90cpp%E6%BA%90%E7%A0%81/img/cover.jpg alt width=3137 height=2048></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#准备工作>准备工作</a></li><li><a href=#使用-matlab-coder-生成-cpp-源码>使用 MATLAB Coder 生成 Cpp 源码</a><ul><li><a href=#准备待转换的-matlab-代码>准备待转换的 MATLAB 代码</a></li><li><a href=#打开-matlab-coder-并设置变量类型>打开 MATLAB Coder 并设置变量类型</a></li><li><a href=#检查-run-time-问题并转换代码>检查 Run-Time 问题并转换代码</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=准备工作>准备工作<a hidden class=anchor aria-hidden=true href=#准备工作>#</a></h2><table><thead><tr><th>Installing Prerequisite Products</th></tr></thead><tbody><tr><td>MATLAB</td></tr><tr><td>MATLAB Coder</td></tr><tr><td>MATLAB ToolBox (e.g. Signal Processing ToolBox)</td></tr><tr><td>C++ compiler</td></tr></tbody></table><p>MATLAB 及 MATLAB Coder 的安装方法请自行查阅 MATLAB 官方文档。</p><blockquote><p>如果 MATLAB 安装在包含非 7 位 ASCII 字符（例如日语字符）的路径中，MATLAB Coder 可能会由于找不到代码生成库函数而无法工作。</p><p>— MathWorks<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p></blockquote><p>不同的MATLAB版本支持的C/C++编译器也不同，详细的支持列表可参考 MATLAB <a href=https://ww2.mathworks.cn/support/requirements/supported-compilers.html>官方文档</a>，本文将在如下环境中完成所有工作：</p><ul><li>MATLAB 2022a</li><li>Microsoft Visual C++ 2022 v17.0 | nmake (64-bit Windows)</li></ul><blockquote><p>注意：Microsoft Visual C++ 2022 is supported as of R2022a.</p></blockquote><h2 id=使用-matlab-coder-生成-cpp-源码>使用 MATLAB Coder 生成 Cpp 源码<a hidden class=anchor aria-hidden=true href=#使用-matlab-coder-生成-cpp-源码>#</a></h2><p>本节内容参考 MATLAB 官方文档 <a href=https://ww2.mathworks.cn/help/coder/gs/generating-c-code-from-matlab-code-using-the-matlab-coder-project-interface.html>使用 MATLAB Coder App 生成 C 代码</a>。</p><h3 id=准备待转换的-matlab-代码>准备待转换的 MATLAB 代码<a hidden class=anchor aria-hidden=true href=#准备待转换的-matlab-代码>#</a></h3><p>假定我们已经有了一个利用 MATLAB Wavelet Toolbox 编写的文件<code>WaveLet_Fcn.m</code>，该文件包含一个滤波函数<code>WaveLet_Fcn()</code>，内容如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-MATLAB data-lang=MATLAB><span style=display:flex><span><span style=color:#66d9ef>function</span> s0 = <span style=color:#a6e22e>WaveLet_Fcn</span>(data) <span style=color:#75715e>%#codegen</span>
</span></span><span style=display:flex><span>    s=data;
</span></span><span style=display:flex><span>    [c,l]=wavedec(s,<span style=color:#ae81ff>7</span>,<span style=color:#e6db74>&#39;coif5&#39;</span>);
</span></span><span style=display:flex><span>    ca11=appcoef(c,l,<span style=color:#e6db74>&#39;coif5&#39;</span>,<span style=color:#ae81ff>7</span>);
</span></span><span style=display:flex><span>    cd1=detcoef(c,l,<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    cd2=detcoef(c,l,<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    cd3=detcoef(c,l,<span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>    cd4=detcoef(c,l,<span style=color:#ae81ff>4</span>);
</span></span><span style=display:flex><span>    cd5=detcoef(c,l,<span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>    cd6=detcoef(c,l,<span style=color:#ae81ff>6</span>);
</span></span><span style=display:flex><span>    cd7=detcoef(c,l,<span style=color:#ae81ff>7</span>);
</span></span><span style=display:flex><span>    sd1=zeros(<span style=color:#ae81ff>1</span>,length(cd1));
</span></span><span style=display:flex><span>    sd2=wthresh(cd2,<span style=color:#e6db74>&#39;s&#39;</span>,<span style=color:#ae81ff>0.014</span>);
</span></span><span style=display:flex><span>    sd3=wthresh(cd3,<span style=color:#e6db74>&#39;s&#39;</span>,<span style=color:#ae81ff>0.014</span>);
</span></span><span style=display:flex><span>    sd4=wthresh(cd4,<span style=color:#e6db74>&#39;s&#39;</span>,<span style=color:#ae81ff>0.014</span>);
</span></span><span style=display:flex><span>    sd5=wthresh(cd5,<span style=color:#e6db74>&#39;s&#39;</span>,<span style=color:#ae81ff>0.014</span>);
</span></span><span style=display:flex><span>    sd6=wthresh(cd6,<span style=color:#e6db74>&#39;s&#39;</span>,<span style=color:#ae81ff>0.014</span>);
</span></span><span style=display:flex><span>    sd7=wthresh(cd7,<span style=color:#e6db74>&#39;s&#39;</span>,<span style=color:#ae81ff>0.014</span>);
</span></span><span style=display:flex><span>    c2=[ca11,sd7,sd6,sd5,sd4,sd3,sd2,sd1];
</span></span><span style=display:flex><span>    s0=waverec(c2,l,<span style=color:#e6db74>&#39;coif5&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></td></tr></table></div></div><p>该函数具有一个参数<code>data</code>和一个返回值<code>s0</code>，由于 C++ 是静态类型语言，后面我们将会看到，我们需要手动指定<code>data</code>在转换后的实际类型（只需指定函数参数即可，MATLAB 会自动推断返回值类型）。</p><p>注意第一行中我们在函数名后增加了注释<code>%#codegen</code>，该指令会通知 Coder 检查是否存在可能的错误，如果有错就会用波浪线标识出来，详细内容可参考<a href=https://ww2.mathworks.cn/help/coder/gs/generating-c-code-from-matlab-code-using-the-matlab-coder-project-interface.html>官方文档</a>。</p><h3 id=打开-matlab-coder-并设置变量类型>打开 MATLAB Coder 并设置变量类型<a hidden class=anchor aria-hidden=true href=#打开-matlab-coder-并设置变量类型>#</a></h3><p>在确认没有红色波浪线后，点击 MATLAB 主界面顶端工具栏 “APP—MATLAB Coder” 进入如下图所示的界面：</p><p><img loading=lazy src=img/screenshot1.png alt=screenshot1></p><p>选择待转换的<code>.m</code>文件，点击右下角<code>Next</code>，随后点击<code>Let me enter input or global types directly</code>，这里要指定函数参数<code>data</code>的类型，假设我们希望该变量为<code>double</code>类型一维数组，长度可变，故设置为：</p><p><img loading=lazy src=img/screenshot2.png alt=screenshot2></p><h3 id=检查-run-time-问题并转换代码>检查 Run-Time 问题并转换代码<a hidden class=anchor aria-hidden=true href=#检查-run-time-问题并转换代码>#</a></h3><p>接下来开始选择测试文件，测试文件是一个调用了上述<code>WaveLet_Fcn()</code>函数的文件，这里，我们先新建一个<code>test.m</code>文件，然后在其中写入以下内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-MATLAB data-lang=MATLAB><span style=display:flex><span>data = [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[res] = WaveLet_Fcn(data);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>disp(res)
</span></span></code></pre></div><p><code>test.m</code>文件应与<code>WaveLet_Fcn.m</code>放置在同一目录下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>your_project_name/
</span></span><span style=display:flex><span>├── WaveLet_Fcn.m
</span></span><span style=display:flex><span>└── test.m
</span></span></code></pre></div><p>随后回到 MATLAB Coder，在输入框中选中我们刚刚新建的<code>test.m</code>文件，然后点击<code>Check for Issues</code>。这里如果提示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>Error evaluating test code. 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>原因:
</span></span><span style=display:flex><span>    函数或变量 &#39;test&#39; 无法识别
</span></span></code></pre></div><p>请退出 MATLAB Coder，在 MATLAB 中运行一次<code>test.m</code>文件，把<code>test.m</code>文件所在目录添加到 MATLAB 路径中，再重新运行 MATLAB Coder，点击<code>Reopen</code>，即可正确运行。</p><p><img loading=lazy src=img/screenshot3.png alt=screenshot3></p><p>如果程序提醒：<code>No issues detected.</code></p><p><img loading=lazy src=img/screenshot4.png alt=screenshot4></p><p>则直接继续点击<code>Next</code>：</p><p><img loading=lazy src=img/screenshot5.png alt=screenshot5></p><p>按上图调整设置，并点击生成代码。弹出的界面左下角可以看到输出的所有 C++ 文件（<code>.h</code>和<code>.Cpp</code>）：</p><p><img loading=lazy src=img/screenshot6.png alt=screenshot6></p><p>这些文件都被放置在<code>WaveLet_Fcn.m</code>所在目录的<code>codegen\lib\WaveLet_Fcn</code>文件夹下。只需将<strong>所有</strong><code>.h</code>和<code>.Cpp</code>复制到 QT Project 或其它项目中编译即可，函数入口就在<code>WaveLet_Fcn.h</code>文件中。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Bash data-lang=Bash><span style=display:flex><span>your_project_name/
</span></span><span style=display:flex><span>├── WaveLet_Fcn.m
</span></span><span style=display:flex><span>├── test.m
</span></span><span style=display:flex><span>└── codegen/
</span></span><span style=display:flex><span>    ├── lib/
</span></span><span style=display:flex><span>    │   └── WaveLet_Fcn/
</span></span><span style=display:flex><span>    │       ├── examples/
</span></span><span style=display:flex><span>    │       │   └── ...
</span></span><span style=display:flex><span>    │       ├── html/
</span></span><span style=display:flex><span>    │       │   └── ...
</span></span><span style=display:flex><span>    │       ├── interface/
</span></span><span style=display:flex><span>    │       │   └── ...
</span></span><span style=display:flex><span>    │       ├── idwt.c
</span></span><span style=display:flex><span>    │       ├── idwt.h
</span></span><span style=display:flex><span>    │       ├── rt_nonfinite.c
</span></span><span style=display:flex><span>    │       ├── rt_nonfinite.h
</span></span><span style=display:flex><span>    │       ├── rtGetInf.c
</span></span><span style=display:flex><span>    │       ├── rtGetInf.h
</span></span><span style=display:flex><span>    │       ├── rtGetNaN.c
</span></span><span style=display:flex><span>    │       ├── rtGetNaN.h
</span></span><span style=display:flex><span>    │       ├── rtwtypes.h
</span></span><span style=display:flex><span>    │       ├── upsconv1.c
</span></span><span style=display:flex><span>    │       ├── upsconv1.h
</span></span><span style=display:flex><span>    │       ├── wavedec.c
</span></span><span style=display:flex><span>    │       ├── wavedec.h
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn_data.c
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn_data.h
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn_emxAPI.c
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn_emxAPI.h
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn_emxutil.c
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn_emxutil.h
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn_initialize.c
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn_initialize.h
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn_terminate.c
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn_terminate.h
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn_types.h
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn.c
</span></span><span style=display:flex><span>    │       ├── WaveLet_Fcn.h
</span></span><span style=display:flex><span>    │       ├── wkeep1.c
</span></span><span style=display:flex><span>    │       └── wkeep1.h
</span></span><span style=display:flex><span>    └── mex/
</span></span><span style=display:flex><span>        └── ...
</span></span></code></pre></div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>The above note is excerpted from MathWorks&rsquo; <a href=https://ww2.mathworks.cn/help/coder/gs/installing-prerequisite-products.html>Help Center</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://yuyangwang-git.github.io/tags/c++/>C++</a></li><li><a href=https://yuyangwang-git.github.io/tags/matlab/>MATLAB</a></li></ul><nav class=paginav><a class=prev href=https://yuyangwang-git.github.io/posts/windows%E4%B8%8B%E6%9E%84%E5%BB%BAstm32%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/><span class=title>« Prev</span><br><span>Windows 下构建 STM32 开发环境</span></a>
<a class=next href=https://yuyangwang-git.github.io/posts/const-member-functions/><span class=title>Next »</span><br><span>C++ 常量成员函数</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://yuyangwang-git.github.io>Yuyang Wang's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>